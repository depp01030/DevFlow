éå¸¸å¥½ï¼ä½ æŠ“åˆ°ä¸€å€‹å¯¦å‹™ä¸­å¾ˆå¸¸è¦‹çš„åšæ³•ï¼šã€Œ**ç”¨ ORM å¯¦ä½œ DAO æ¨¡å¼**ã€ï¼Œä¹Ÿå°±æ˜¯å°‡ ORM æŸ¥è©¢å°è£åœ¨ DAO é¡åˆ¥è£¡ï¼Œè®“é‚è¼¯æ›´ä¹¾æ·¨ã€å¯æ¸¬è©¦ã€å®¹æ˜“ç¶­è­·ã€‚

---

## ğŸ’¡ é€™å¥è©±çš„æ„æ€æ˜¯ï¼š

> å³ä½¿æˆ‘å€‘ç”¨äº† ORMï¼ˆåƒ SQLAlchemyï¼‰ï¼Œä¹Ÿ**ä¸æœƒåœ¨ Controller æˆ– Service è£¡ç›´æ¥åˆ°è™•å¯« ORM æŸ¥è©¢èªå¥**ï¼Œè€Œæ˜¯**çµ±ä¸€æ”¾é€² DAOï¼ˆData Access Objectï¼‰é¡åˆ¥è£¡**ä¾†ä½¿ç”¨ã€‚

é€™æ¨£åšçš„å¥½è™•ï¼š

* ğŸ“¦ **å°è£æ€§**ï¼šè³‡æ–™å­˜å–é‚è¼¯é›†ä¸­è™•ç†ï¼Œä¸æ±¡æŸ“æ¥­å‹™é‚è¼¯å±¤
* ğŸ” **å¯é‡ç”¨æ€§**ï¼šåŒæ¨£çš„æŸ¥è©¢å¯ä»¥åœ¨å¤šå€‹åœ°æ–¹ä½¿ç”¨
* ğŸ” **æ˜“æ–¼æ¸¬è©¦**ï¼šå¯ä»¥ mock DAOï¼Œè€Œä¸ç”¨ mock ORM/session
* ğŸ§± **æ›´æ¸…æ™°çš„åˆ†å±¤æ¶æ§‹**

---

## ğŸ§ª å¯¦ä½œç¯„ä¾‹ï¼ˆä½¿ç”¨ Python + SQLAlchemyï¼‰

### ğŸ“ çµæ§‹

```
app/
â”‚
â”œâ”€â”€ models/
â”‚   â””â”€â”€ user_model.py
â”œâ”€â”€ dao/
â”‚   â””â”€â”€ user_dao.py
â”œâ”€â”€ services/
â”‚   â””â”€â”€ user_service.py
â””â”€â”€ main.py
```

---

### 1ï¸âƒ£ `user_model.py` â€” å®šç¾© ORM Model

```python
from sqlalchemy import Column, Integer, String
from sqlalchemy.orm import declarative_base

Base = declarative_base()

class User(Base):
    __tablename__ = 'users'
    
    id = Column(Integer, primary_key=True)
    name = Column(String)
    email = Column(String)
```

---

### 2ï¸âƒ£ `user_dao.py` â€” DAO å°è£ ORM æŸ¥è©¢é‚è¼¯

```python
from models.user_model import User

class UserDAO:
    def __init__(self, session):
        self.session = session

    def get_user_by_id(self, user_id):
        return self.session.query(User).filter(User.id == user_id).first()

    def create_user(self, name, email):
        user = User(name=name, email=email)
        self.session.add(user)
        self.session.commit()
        return user

    def get_all_users(self):
        return self.session.query(User).all()
```

---

### 3ï¸âƒ£ `user_service.py` â€” ä½¿ç”¨ DAO å¯¦ä½œæ¥­å‹™é‚è¼¯

```python
class UserService:
    def __init__(self, user_dao):
        self.user_dao = user_dao

    def register_user(self, name, email):
        # æ¥­å‹™é‚è¼¯å¯åŠ é©—è­‰ã€æª¢æŸ¥æ˜¯å¦é‡è¤‡ç­‰ç­‰
        return self.user_dao.create_user(name, email)

    def find_user(self, user_id):
        return self.user_dao.get_user_by_id(user_id)
```

---

### 4ï¸âƒ£ `main.py` â€” çµ„è£æ‰€æœ‰å…ƒä»¶ä¸¦æ¨¡æ“¬ä½¿ç”¨

```python
from sqlalchemy import create_engine
from sqlalchemy.orm import sessionmaker

from models.user_model import Base
from dao.user_dao import UserDAO
from services.user_service import UserService

# åˆå§‹åŒ– DBï¼ˆå‡è¨­ç”¨ SQLiteï¼‰
engine = create_engine('sqlite:///:memory:', echo=True)
Session = sessionmaker(bind=engine)
session = Session()

# å»ºç«‹è³‡æ–™è¡¨
Base.metadata.create_all(engine)

# å»ºç«‹ DAO & Service
user_dao = UserDAO(session)
user_service = UserService(user_dao)

# ä½¿ç”¨ Serviceï¼ˆèƒŒå¾Œä½¿ç”¨ ORM + DAOï¼‰
user = user_service.register_user("Alice", "alice@example.com")
print(user_service.find_user(user.id).name)
```

---

## âœ… æœ€çµ‚é—œä¿‚ï¼š

* `User` æ˜¯ **ORM Model**
* `UserDAO` æ˜¯ **è³‡æ–™æ“ä½œå°è£è€…ï¼ˆDAOï¼‰**ï¼Œä½¿ç”¨ ORM èªæ³•æŸ¥è³‡æ–™
* `UserService` æ˜¯ **æ‡‰ç”¨é‚è¼¯å±¤**ï¼Œå‘¼å« DAO å®Œæˆä»»å‹™
* `main.py` æ˜¯ **è¡¨ç¾å±¤æˆ–å•Ÿå‹•é»**ï¼Œå‘¼å« Service è€Œä¸ç”¨ç¢° ORM ç´°ç¯€

---

## ğŸ”š çµè«–ï¼š

* ORM : è² è²¬è®“ä½¿ç”¨è€…èƒ½ä»¥â€œç‰©ä»¶â€çš„æ–¹å¼ï¼Œèˆ‡è³‡æ–™åº«äº’å‹•ã€‚
* DAO : è² è²¬å°è£ ORM çš„æŸ¥è©¢é‚è¼¯ï¼Œè®“æ¥­å‹™é‚è¼¯å±¤ä¸éœ€è¦çŸ¥é“ ORM çš„ç´°ç¯€ã€‚
* Service : è² è²¬æ¥­å‹™é‚è¼¯ï¼Œå‘¼å« DAO å®Œæˆä»»å‹™ã€‚
* Controller : è² è²¬æ¥æ”¶è«‹æ±‚ï¼Œå‘¼å« Service å®Œæˆ


| å…ƒä»¶             | ä¸»è¦è²¬ä»»èªªæ˜                                           |
| -------------- | ------------------------------------------------ |
| **ORM**        | æä¾›ä¸€å¥—å·¥å…·ï¼Œè®“é–‹ç™¼è€…å¯ä»¥ç”¨ã€Œç‰©ä»¶å°å‘æ–¹å¼ã€æ“ä½œè³‡æ–™è¡¨ï¼ˆä¸ç”¨ç›´æ¥å¯« SQLï¼‰           |
| **DAO**        | å°è£æ‰€æœ‰è³‡æ–™å­˜å–é‚è¼¯ï¼ˆå³ä½¿ç”¨ ORM æŸ¥è©¢/æ›´æ–°çš„éƒ¨åˆ†ï¼‰ï¼Œè®“ä¸Šå±¤ä¸éœ€è¦äº†è§£è³‡æ–™åº«æˆ– ORM ç´°ç¯€ |
| **Service**    | è² è²¬è™•ç†æ¥­å‹™é‚è¼¯ï¼Œä¾‹å¦‚æµç¨‹æ§åˆ¶ã€è³‡æ–™é©—è­‰ã€éŒ¯èª¤è™•ç†ï¼Œé€éå‘¼å« DAO ä¾†åŸ·è¡Œè³‡æ–™æ“ä½œ       |
| **Controller** | æ¥æ”¶å¤–éƒ¨è«‹æ±‚ï¼ˆé€šå¸¸æ˜¯ HTTPï¼‰ï¼Œè§£æè¼¸å…¥ã€å‚³å…¥ Service åŸ·è¡Œï¼Œä¸¦è™•ç†å›æ‡‰è¼¸å‡º      |
