# 🔥 Socket 與通訊協議完整介紹

---

## 一、什麼是 Socket？

✅ **Socket 是一種概念，它定義了一種「網路通訊的抽象模型與操作介面」。**

簡單來說，Socket 讓你的程式可以透過作業系統，  
使用底層的網路協議（像是 TCP 或 UDP）來：

- 建立連線
- 傳送資料
- 接收資料
- 關閉連線

✅ Socket 是「技術抽象」＋「操作接口」，而不是傳輸協議本身。

---

## 二、Socket 如何分類？

Socket 根據使用的協議不同，分為：

| 類型 | 說明 | 特性 | 適合場景 |
|:---|:---|:---|:---|
| TCP socket | 使用 TCP 協議 | 可靠傳輸、連線導向、有順序 | 網頁請求、API、資料庫 |
| UDP socket | 使用 UDP 協議 | 不保證順序、速度快、無連線 | 線上遊戲、影音串流 |

✅ Socket 本身只是一個「操作門口」，  
真正負責搬運資料的，是 TCP 或 UDP 這些傳輸協議。

---

## 三、TCP 與 UDP 是什麼？

### TCP（Transmission Control Protocol）
- 需要「三次握手」建立連線
- 保證資料到達、不重複、不遺失、順序正確
- 傳輸穩定但速度較慢

### UDP（User Datagram Protocol）
- 不建立連線，直接送資料
- 不保證資料順序或到達
- 速度快但容易掉資料

✅ TCP 適合要求可靠性的場景；UDP 適合要求速度的場景。

---

## 四、WebSocket 是什麼？跟 TCP/UDP 有什麼關係？

✅ **WebSocket 是一種高層級的「應用層協議」，建立在 TCP 之上。**

- 一開始會用 HTTP 請求升級成 WebSocket
- 成功後建立一條「持久開啟的 TCP 連線」
- 支援雙向即時通訊（client/server 都可以主動發送資料）

✅ 簡單來說：
> **WebSocket = 基於 TCP socket，實現持久雙向溝通的聊天協議。**

---

## 五、TCP 詳細傳輸機制：三次握手與資料確認

### 三次握手 (Three-way Handshake) 是為了什麼？

✅ **三次握手是為了建立 TCP 連線本身，確認雙方能雙向收發資料。**  
✅ 它不是用來確認傳送的資料有沒有掉！

| 步驟 | 內容 | 意義 |
|:---|:---|:---|
| 第一次 (SYN) | 客戶端發送「我要連線」(SYN) 給伺服器 | 告訴伺服器想建立連線 |
| 第二次 (SYN-ACK) | 伺服器回「好，我知道了」(SYN + ACK) | 告訴客戶端伺服器準備好 |
| 第三次 (ACK) | 客戶端再回「好，我也知道了」(ACK) | 雙方確認連線完成 |

✅ 完成後，TCP 連線正式建立，雙方可以開始傳送資料！

---

### 🔴 特別澄清常見誤會

> ❌ **TCP 不是每次傳資料都要重新三次握手！**

✅ 正確是：

- 「三次握手」**只發生在建立連線的時候，一次而已。**
- 之後連線保持打開，資料直接傳輸，不需要重複三次握手。

✅ 資料的可靠性，是由 TCP 的內建機制保證的，包括：
- 資料編號（Sequence Number）
- 確認回覆（ACK）
- 超時重傳（Retransmission）
- 校驗碼（Checksum）

---

## 六、資料傳輸流程簡述

TCP 傳送資料時，會自動做這些事情：

1. 資料加上序號（Sequence Number）
2. 對方收到後回傳 ACK 確認
3. 如果超時未收到 ACK，TCP 自動重送
4. 每段資料加上 checksum 驗證完整性

✅ 這一切都是 TCP 自動管理，應用層（例如 WebSocket）完全不用管。

---

## 七、📚 超短總結

| 項目 | 說明 |
|:---|:---|
| Socket | 提供程式操作網路連線的介面 |
| TCP socket | 穩定可靠，適合要求資料完整性的場景 |
| UDP socket | 快速傳輸，適合即時但可容錯的場景 |
| WebSocket | 基於 TCP 的雙向持久連線協議 |
| 三次握手 | 只在建立 TCP 連線時進行一次 |
| 資料確認 | 由 TCP 底層負責（ACK、序號、重傳） |

---

# 🎯 一句話總結

> **Socket 是搬資料的門口，TCP/UDP 是搬資料的規則，WebSocket 是在 TCP 上開的即時聊天專線。**

---

# 🎁 小彩蛋：三次握手，其實跟內網打不通外網有關？

你知道嗎？

✅ 當我們在說「三次握手建立連線」、「Socket 綁定 IP 和 port」的時候，  
其實已經牽涉到：

- 你的 IP 是內網還是外網？
- 你能不能主動發起連線？
- 外網能不能反向連進你的內網？
- NAT（Network Address Translation）是怎麼處理 TCP 連線的？

✅ 這也是為什麼：

- **內網可以主動連到外網**（因為自己發起三次握手）
- **但外網卻無法直接打進內網**（因為內網沒有開門聽，三次握手第一步送不進來）

🚀 後面如果我們學 NAT、防火牆、打洞 (hole punching)、P2P 通訊，  
就會看到這些知識在真實世界裡怎麼影響「能不能連線」、「誰能連誰」！

敬請期待！

---
