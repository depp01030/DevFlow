# 系統架構：分類與資料流

---

這份筆記旨在幫助你理解一個現代後端系統在實務開發中常見的分層邏輯與資料流動方式。雖然名詞看起來很多，但其實它們都是從不同角度描述同一個系統。透過本文，你可以快速掌握：

1. 系統的分類方式有哪些？
2. 為什麼我們說資料流動才是核心？
3. 你的專案選擇了哪些實作方式？
4. 這些做法與設計模式（例如 MVC）有什麼關聯？

---

## 1. 不同的分類視角

我們可以從四個角度來理解整個系統：責任分層、資料流物件、程式碼結構、設計模式。這些角度是重疊的，不是彼此獨立的分類，而是為了幫助你切換視角、理解各層關係。

### 責任分層（Responsibility Layers）
這是最常見的系統劃分方法：
- 呈現層（Presentation Layer）：處理畫面、輸入輸出、UI 顯示
- 業務邏輯層（Business Logic Layer）：負責處理流程與決策邏輯
- 持久層（Persistence Layer）：與資料庫的讀寫互動

### 資料流物件（Data Flow Objects）
這是針對資料在系統內移動的角色來分類：
- Form Object：前端表單資料（例如使用者輸入）
- DTO（Data Transfer Object）：傳輸資料用的中立格式
- Entity：資料庫對應的實體物件（本專案未使用）
- DAO：資料存取邏輯封裝（本專案未使用）
- VO：描述型值物件（可選）

### 專案結構（Project Structure）
這是開發實作時的模組分法：
- Router / Controller：負責接收請求與分派邏輯
- Service：執行主要的業務邏輯
- Model（ORM）：對應資料表結構與查詢邏輯
- Schema：驗證與解析輸入資料

### 設計模式（Design Patterns）
這是將程式行為歸納成的標準模型：
- MVC：最常見的三層模式，將程式分成 Model、View、Controller
- MVVM：前端常見的綁定式設計，View 與 ViewModel 雙向綁定
- DDD：領域驅動設計，強調語意與邏輯分界

---

## 2. 系統整合觀點：以資料流為主線

理解一個系統最有效的方法，不是背誦名詞分類，而是從「一筆資料是怎麼流動的」出發，追蹤它經過哪些層、轉換成什麼格式、由誰處理與回傳。

這裡，我們不再分開看責任層、設計模式或物件種類，而是把它們整合成一條有順序、有邏輯的資料通道。

你將會看到：
- 資料從使用者畫面出發，如何打包成請求送出
- 後端接收並驗證請求，進行處理與資料存取
- 最終將結果包裝回傳，回到畫面上

透過這條通道，我們也可以對照每個階段對應到的角色與責任，形成一條完整的資料生命路徑。

### 資料流動過程：

以下用純文字方式圖像化整個資料流動流程，讓你更容易想像整體架構中資料的走向與責任分層：

```
[使用者畫面]
    ｜
    ｜ 使用者操作（輸入文字、按下按鈕）
    ｜
    v
[前端 Controller]
    ｜ 收集資料，組成 Frontend DTO
    ｜
    v
[API Request]
    ｜ 發送 HTTP 請求
    v
[後端 Router / Controller]
    ｜ 接收請求，透過 Schema 驗證
    ｜ 組成 Backend DTO
    ｜
    v
[Service]
    ｜ 業務邏輯處理（如查詢、驗證、計算）
    ｜
    v
[ORM Model]
    ｜ 直接操作資料庫（新增 / 查詢 / 修改）
    ｜
    v
[資料庫]
    ｜ 回傳資料
    v
[ORM Model → Service]
    ｜ 組裝 Response DTO
    ｜
    v
[Router → 回傳 JSON 給前端]
    ｜
    v
[前端 Controller → View 更新]
    ｜ 將回傳結果顯示在畫面上
    v
[使用者看到更新畫面]
```

這個流程圖展示了資料如何從「使用者輸入」一路傳遞、驗證、處理、儲存、再回傳回來給使用者，整個架構脈絡就清楚可見。

**前端流程：**
- 使用者互動（View）：輸入資料、點擊按鈕
- ↓
- 前端控制器收集資料，轉成前端 DTO
- ↓
- 呼叫 API

**後端流程：**
- 路由（Router）接收請求，使用 Schema 驗證資料結構與格式
- ↓
- Service 接手 DTO，執行商業邏輯（例如查資料、比對條件、計算）
- ↓
- 操作 ORM Model，與資料庫互動（讀取、修改）
- ↓
- 資料庫

**回傳資料流程：**
- 資料庫回傳 ORM Model 結果
- → Service 組裝成 Response DTO
- → 回傳給前端，更新畫面

這整條流程，貫穿了所有責任層與分類角度。

---

## 3. 本專案中的設計取捨

在實務上，為了加快開發或避免過度設計，你的專案做了以下幾點取捨：

- **未使用 Entity 層**  
  Service 直接處理 DTO，不再轉換為實體物件。

- **未使用 Repository 層**  
  ORM Model 直接與資料庫互動，不抽出額外封裝層。

- **DTO 是核心物件**  
  不論輸入、處理、回傳，都是用 DTO 做資料交換。

- **ORM Model = MVC 的 Model**  
  是儲存資料的實際對應結構。

這樣的架構更輕量，適合早期快速開發，也更容易追資料流。

---

## 4. 快速對應表格

透過表格，你可以快速把每個階段對應到責任層與 MVC 的角色：

| 流程階段         | 責任分層              | MVC 對應角色         | 使用物件            |
|:------------------|:----------------------|:----------------------|:---------------------|
| 使用者輸入        | 前端呈現層            | View（視圖）         | Form Object（表單物件） |
| API 呼叫          | 前端控制器            | Controller（控制器） | Frontend DTO         |
| 後端接收          | 後端呈現層            | Controller（控制器） | Backend DTO + Schema |
| 業務邏輯處理      | 後端業務邏輯層        | Controller（實際控制） | Backend DTO         |
| 資料存取          | 後端持久層            | Model（模型）         | ORM Model            |
| 建立回傳資料      | 後端呈現層            | View（視圖）         | Response DTO         |

---

## 5. 最終總結

> 以你的架構來說：  
> - ORM Model **=** MVC 中的 Model  
> - Service **=** 真正的 Controller  
> - DTO **=** 核心資料物件  
> - 不使用 Entity，不使用 Repository 抽象層

這是一種輕量化、實務導向的 MVC 架構實作方式，專注在清楚的資料流程與易維護的分工，適合中小型專案開發，也非常適合初學者理解全貌。

---

如果你能熟練掌握這個流程，未來不論你是要改成 DDD 架構、加上 Repository 抽象、或是拆出 microservice，都能更有基礎與信心去做決策。

